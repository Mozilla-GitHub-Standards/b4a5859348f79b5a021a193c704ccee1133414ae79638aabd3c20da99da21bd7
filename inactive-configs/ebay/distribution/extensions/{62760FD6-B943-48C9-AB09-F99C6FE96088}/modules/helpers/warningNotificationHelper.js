/* Copyright (C) 2007-2011 eBay Inc. All Rights Reserved. */const EXPORTED_SYMBOLS=["WarningNotificationHelper"];const Cc=Components.classes;const Ci=Components.interfaces;const Ce=Components.Exception;const Cr=Components.results;const Cu=Components.utils;var WarningNotificationHelper={BEST_OFFER_NOT_SUPPORTED_WARNING:10,LIST_LIMITED_WARNING:11,API_CONNECTION_WARNING:12,ADD_TO_WATCHLIST_ERROR_WARNING:13,REMOVE_FROM_WATCHLIST_ERROR_WARNING:14,HARD_UPDATE_ERROR_WARNING:15,ITEM_MOVED_TO_ENDED_TAB_WARNING:16,BIDDING_FILTER_WARNING:17,WATCHING_FILTER_WARNING:18,SELLING_FILTER_WARNING:19,WATCHED_FILTER_WARNING:20,WON_FILTER_WARNING:21,LOST_FILTER_WARNING:22,SOLD_FILTER_WARNING:23,UNSOLD_FILTER_WARNING:24,SIGNED_OUT_WARNING:25,LOGIN_FAILED_WARNING:26,SECURITY_SIGN_OUT_WARNING:27,REMOVE_FROM_DIDNTWINLIST_ERROR_WARNING:28,REMOVE_FROM_WONLIST_ERROR_WARNING:29,WARN_NOTIFICATION_TOPIC:"ebay-warning-notification",CLEAR_NOTIFICATION_BOX_TOPIC:"ebay-clear-warning-notificationbox",RESET_CURRENT_TAB_FILTER_TOPIC:"ebay-reset-current-tab-filter",WARN_NOTIFICATION_IMAGE:"chrome://ebaycompanion/skin/images/warningNotification.png",_warnNotification:null,_observers:null,_init:function(){try{Cu.import("resource://ebaycompanion/helpers/logger.js");Cu.import("resource://ebaycompanion/helpers/observers.js");this._observers=new Observers;let(that=this){this._observers.add(function(){that._uninit()},"quit-application-granted");}}
catch(e){Logger.exception(e);}},_uninit:function(){try{this._clearQueue();this._observers.removeAll();}
catch(e){Logger.exception(e);}},showPendingNotifications:function(){try{let nextNotification=this.getNextNotification();if(null!=nextNotification){Observers.notify(nextNotification,this.WARN_NOTIFICATION_TOPIC,null);}else{Observers.notify(null,this.CLEAR_NOTIFICATION_BOX_TOPIC,null);}}catch(e){Logger.exception(e);}},getNextNotification:function(){let next=null;try{next=this._warnNotification;}catch(e){Logger.exception(e);return null;}
return next;},queueNotification:function(aNotification){try{aNotification.set("imageURL",this.WARN_NOTIFICATION_IMAGE);this._warnNotification=aNotification;this.showPendingNotifications();}catch(e){Logger.exception(e);}},dismissNotification:function(aNotificationType){this._removeNotificationsByType(aNotificationType);this.showPendingNotifications();if(aNotificationType>=this.BIDDING_FILTER_WARNING&&aNotificationType<=this.UNSOLD_FILTER_WARNING){Observers.notify(null,this.RESET_CURRENT_TAB_FILTER_TOPIC,null);}},dismissFilterNotifications:function(){for(var i=WarningNotificationHelper.BIDDING_FILTER_WARNING;i<=WarningNotificationHelper.UNSOLD_FILTER_WARNING;i++){this._removeNotificationsByType(i);}
this.showPendingNotifications();},_removeNotificationsByType:function(aType){try{if(this._warnNotification&&aType==this._warnNotification.get("type")){this._warnNotification=null;}}catch(e){Logger.exception(e);}},removeCurrentNotification:function(aIsPersistent){try{this._warnNotification=null;this.showPendingNotifications();}catch(e){Logger.exception(e);}},_clearQueue:function(){try{this._warnNotification=null;}catch(e){Logger.exception(e);}},clearCurrentNotification:function(){try{if(null!=this._warnNotification&&!this._warnNotification.get("isPersistent")){this._warnNotification=null;}}catch(e){Logger.exception(e);}}};WarningNotificationHelper._init();