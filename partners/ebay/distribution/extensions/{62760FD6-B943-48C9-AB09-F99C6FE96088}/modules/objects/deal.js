/* Copyright (C) 2007-2011 eBay Inc. All Rights Reserved. */const EXPORTED_SYMBOLS=["Deal"];const Cc=Components.classes;const Ci=Components.interfaces;const Ce=Components.Exception;const Cr=Components.results;const Cu=Components.utils;Cu.import("resource://ebaycompanion/helpers/objectHelper.js");Cu.import("resource://ebaycompanion/constants.js");function Deal(itemId){if(itemId){this.set("itemId",itemId);}}
Deal.prototype={constructor:Deal,propertyTypes:{itemId:"number",title:"string",isEnded:"boolean",currentPrice:"number",currency:"string",rrp:"number",rrpCurrency:"string",shippingCost:"number",freeShipping:"boolean",quantitySold:"number",quantity:"number",startTime:"string",endTime:"string",imageUrl:"string",thumbnailUrl:"string",savingsRate:"number",savingsRateText:"string",sellerUserId:"string",sellerFeedbackRating:"number",sellerFeedbackPercent:"number",pageViews:"number"},propertyXML:{itemId:"@ItemID",title:"Title",isEnded:"ItemMetaData.IsExpired",currentPrice:"ItemDetails.ConvertedCurrentPrice",currency:"ItemDetails.ConvertedCurrentPrice.@CurrencyID",rrp:"ItemDetails.RRP",rrpCurrency:"ItemDetails.RRP.@CurrencyID",shippingCost:"ItemDetails.ShippingPrice",freeShipping:"ItemMetaData.FreeShipping",quantitySold:"ItemMetaData.QuantitySold",quantity:"ItemMetaData.Quantity",startTime:"@DateAdded",endTime:"ItemMetaData.EndTime",imageUrl:"ItemDetails.PictureURL",thumbnailUrl:"ItemDetails.GalleryURL",savingsRate:"ItemMetaData.SavingsRate",savingsRateText:"ItemMetaData.SavingsRateText",sellerUserId:"",sellerFeedbackRating:"",sellerFeedbackPercent:"",pageViews:""},copy:function(){let copy=new Deal(this.get("itemId"));copy.updateQuietlyTo(this);return copy;},updateTo:function(aNewObject,aFlags,aIgnorePropertiesArray){return ObjectHelper.updateObject(this,aNewObject,"ebay-deal-property-updated",aFlags,aIgnorePropertiesArray);},updateQuietlyTo:function(aNewObject){return this.updateTo(aNewObject,ObjectHelper.flags.NO_NOTIFICATIONS);},updateProperty:function(aProperty,aValue){return ObjectHelper.updateProperty(this,aProperty,aValue,"ebay-deal-property-updated");},get:function(aProperty){return ObjectHelper.getProperty(this,aProperty);},set:function(aProperty,aValue){aValue=ObjectHelper.filterValue(aProperty,this.propertyTypes[aProperty],aValue);this["_"+aProperty]=aValue;},fromXMLNode:function(aXMLNode){var deal=ObjectHelper.fromXML(aXMLNode,this);this.updateTo(deal);if(this.get("startTime")){this.set("startTime",this._getTimestamp(this.get("startTime")));}
if(this.get("endTime")){this.set("endTime",this._getTimestamp(this.get("endTime")));}},_getTimestamp:function(aTimeString){let dateRegExp=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})Z$/;let dateResults=dateRegExp.exec(aTimeString);let date=new Date();let timestamp=null;if(dateResults){date.setUTCFullYear(dateResults[1],dateResults[2]-1,dateResults[3]);date.setUTCHours(dateResults[4],dateResults[5],dateResults[6]);}else{Logger.error("Incompatible date format: "+aTimeString,Logger.DUMP_STACK);}
timestamp=String(date.getTime());return timestamp;},};