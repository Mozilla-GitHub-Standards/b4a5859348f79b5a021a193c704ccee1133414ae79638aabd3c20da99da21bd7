/* Copyright (C) 2007-2011 eBay Inc. All Rights Reserved. */EbayCompanion.Alerts={init:function(){try{this._observers=new EbayCompanion.Observers;this._panel=document.getElementById("gs-ebay-alert-panel");this._alertbox=document.getElementById("ec-alert-box");let that=this;this._observers.add(function(aAlert){that._showPrimaryAlert(aAlert);},"ebay-alert-show-primary");this._observers.add(function(aAlert){that._showSecondaryAlert(aAlert);},"ebay-alert-show-secondary");this._observers.add(function(aAlert){that._showAlertBox(aAlert);},"ebay-alert-show-item");this._observers.add(function(aAlert){that.closePanel();},"ebay-alert-close-item");if(typeof(EbayCompanion.AlertsService)=="undefined"){EbayCompanion._importModule("alertsService.js");}
EbayCompanion.AlertsService.showCurrentAlerts();}catch(e){EbayCompanion.Logger.exception(e);}},uninit:function(){try{this._observers.removeAll();}catch(e){EbayCompanion.Logger.exception(e);}},_showAlertBox:function(aAlert){this._alertbox.currentAlertIndex=EbayCompanion.AlertsService.getPrimaryAlertsIndex();this._alertbox.alertsQueueLength=EbayCompanion.AlertsService.getPrimaryAlertsSize();this._alertbox.alert=aAlert;},_showPrimaryAlert:function(aAlert){let showAlertSafely=true;let appInfo=Cc["@mozilla.org/xre/app-info;1"].getService(Ci.nsIXULAppInfo).QueryInterface(Ci.nsIXULRuntime);if(appInfo.platformVersion.indexOf("1.9.0")==0){let win=document.defaultView;let isMinimized=win.windowState==Ci.nsIDOMChromeWindow.STATE_MINIMIZED;showAlertSafely=!isMinimized;}
if(showAlertSafely){let bottomBox=document.getElementById("browser-bottombox");let currentAlert=EbayCompanion.AlertsService.getCurrentPrimaryAlert();this._showAlertBox(currentAlert);if(this._panel.state=="closed"){this._panel.openPopup(bottomBox,"before_end",-20,-2,false,false);}}},_showSecondaryAlert:function(aAlert){let toolbarButton=document.getElementById("ec-toolbar-button");let statusbarButton=document.getElementById("gs-ebay-statusbar-button");let ebayButton=toolbarButton?toolbarButton:statusbarButton;if(ebayButton){ebayButton.glowing=true;}
EbayCompanion.updateButtonTooltip();window.setTimeout(function(){EbayCompanion.Observers.notify(aAlert.object,"ebay-hightlight-item",null);},2000);},closeCurrentAlert:function(){let currentAlert=EbayCompanion.AlertsService.getCurrentPrimaryAlert();EbayCompanion.AlertsService.dismissAlert(currentAlert);},closePanel:function(){this._panel.hidePopup();}}