
Components.utils.import("resource://gre/modules/XPCOMUtils.jsm");var CI=Components.interfaces;var CC=Components.classes;var yahooCC=CC;var yahooCI=CI;var loader=CC["@mozilla.org/moz/jssubscript-loader;1"].getService(CI.mozIJSSubScriptLoader);loader.loadSubScript("chrome://ytoolbar/content/yprefs.js");loader.loadSubScript("chrome://ytoolbar/content/logger.js");loader.loadSubScript("chrome://ytoolbar/content/utils.js");loader.loadSubScript("chrome://ytoolbar/content/ytb_gradient_generator.js");function WrapperClass(object){this.wrappedJSObject=this;this.object=object;}
WrapperClass.prototype={QueryInterface:function(iid){if(!iid.equals(Components.interfaces.nsISupports)){throw Components.results.NS_ERROR_NO_INTERFACE;}
return this;}}
function YahooDomBuilder(){var _self=this;var _mNS="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul";var _mImagePath="http://us.i1.yimg.com/us.yimg.com/i/tb/icons/";var _mPopupStyle="";var _mColorGroupButtonText="black";var _mColorButtonText="black";var _mColorSearchButtonText="black";var _mDocument=null;var _mGradientGenerator=null;var _mToolbarDocument=null;var sysPrincipal=null;var domParser=null;this.init=function(){try{if(CC["@mozilla.org/xre/app-info;1"].getService(CI.nsIXULAppInfo).platformVersion.indexOf("2")==0){sysPrincipal=Components.classes['@mozilla.org/systemprincipal;1'].createInstance(Components.interfaces.nsIPrincipal);domParser=CC["@mozilla.org/xmlextras/domparser;1"].createInstance(CI.nsIDOMParserJS);domParser.init(sysPrincipal,null,null);_mDocument=domParser.parseFromString("<?xml version=\"1.0\" encoding=\"utf-8\"?> <overlay xmlns=\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\" xmlns:svg=\"http://www.w3.org/2000/svg\" />","text/xml");}else{_mDocument=CC["@mozilla.org/xul/xul-document;1"].createInstance(CI.nsIDOMDocument).implementation.createDocument(_mNS,"overlay",null);}
_mGradientGenerator=new YTBGradientGenerator(_mDocument.createElementNS("http://www.w3.org/1999/xhtml","canvas"));if(CC["@mozilla.org/xre/app-info;1"].getService(CI.nsIXULAppInfo).platformVersion.indexOf("2")==0){_mToolbarDocument=domParser.parseFromString("<?xml version=\"1.0\" encoding=\"utf-8\"?> <overlay xmlns=\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\" xmlns:svg=\"http://www.w3.org/2000/svg\" id=\"toolbar\" />","text/xml");}else{_mToolbarDocument=CC["@mozilla.org/xul/xul-document;1"].createInstance(CI.nsIDOMDocument).implementation.createDocument(_mNS,"overlay",null);_mToolbarDocument.firstChild.setAttribute("id","toolbar");}}catch(e){yahooError(e);}
_self.clear();};var _mConfigManager=CC["@yahoo.com/configmanager;1"].getService(CI.nsIYahooConfigManager);var _mStrings=CC["@mozilla.org/intl/stringbundle;1"].getService(CI.nsIStringBundleService).createBundle("chrome://ytoolbar/locale/ytoolbar.properties");var _mLocalStorage=CC["@yahoo.com/localstorage;1"].getService(CI.nsIYahooLocalStorage);var _mFileIO=CC["@yahoo.com/fileio;1"].getService(CI.nsIYahooFileIO2);var _mSkipAttrs={'id':1,'contextmenu':1,'image':1,'class':1,'tooltiptext':1,'type':1};var _mRightAlignBtns=null;var _mGroupBtns=null;var _mRightSepImg=null;var _mContainer=null;var _mReqBtns=null;var _mBtns=null;var _mCNADom=null;var _mFAVDom=null;var _mTabIndex=0;var _mInsideGroup=false;var _mBaseGroupImage="ddddddddddskins/noskin_grp.png";var _mBaseEndCapImage="ddddddddddddskins/noskin_ec.png";function _getStr(name,def){var str=null;if(_mStrings){str=_mStrings.GetStringFromName(name);}
if(!str&&def){return def;}
return str;}
function _collectAlertData(dom){try
{var alert_data=[];var attr=dom.getAttribute("yhash");if(attr!=undefined){if(attr=="")attr="{}";var tokens=yahooUtils.JSON.parse(attr);for(name in tokens){var k=name;var v=tokens[name];k=k.replace(/^\s+|\s+$/g,"");k=k.replace(/^\'|\'$/g,"");if(v!=undefined){v=v.replace(/^\s+|\s+$/g,"");v=v.replace(/^\'|\'$/g,"");}
switch(k){case"alrt":alert_data["alrt"]=v;break;case"alint":alert_data["alint"]=v;break;case"algst":alert_data["algst"]=v;break;case"alco":alert_data["alco"]=v;break;default:}
if((v!=undefined)&&(v.indexOf("AE_")!=-1)){if(alert_data["displayElement"]==null){alert_data["displayElement"]=[];}
alert_data["displayElement"].push(k);}}}
if(alert_data["alrt"]!=undefined){if(_mLocalStorage!=null){var alert_array=_mLocalStorage.getObject("alert");if(alert_array!=null){alert_array=alert_array.wrappedJSObject.object;}
if(alert_array==undefined){alert_array=[];}
alert_array.push(alert_data);_mLocalStorage.putObject("alert",new WrapperClass(alert_array));}else{yahooDebug("Yahoo LocalStorage Failed");}}else{}}catch(e){yahooError("Error in _collectAlertData "+e);}}
function _createSplitter(){var splitter=_mToolbarDocument.createElementNS(_mNS,"splitter");splitter.id="yahoo-toolbar-splitter";splitter.setAttribute("resizebefore","grow");splitter.setAttribute("resizeafter","grow");splitter.setAttribute("class","searchbox-splitter");splitter.setAttribute("onmouseup","YahooToolbarBuilder.splitterResize()");splitter.setAttribute("onclick","YahooToolbarBuilder.setSearchboxSize()");return splitter;}
function _buildSearchBox(node){var search=null;var dom=_mToolbarDocument.createElementNS(_mNS,"toolbaritem");dom.setAttribute("class","yahoo-toolbar-searchbox-container");dom.setAttribute("flex","1");dom.setAttribute("minwidth","80");dom.setAttribute("width","180");dom.setAttribute("maxheight","24");dom.setAttribute("align","center");try{var search=_mToolbarDocument.createElementNS(_mNS,"textbox");search.setAttribute("id","yahooToolbarEditBox");search.setAttribute("flex","1");search.setAttribute("height",23);search.setAttribute("width",212);search.setAttribute("style","padding-top:3px;margin: 1px 5px 5px 5px; border: 1px inset #716f64; align: center; height: 23px");search.setAttribute("yevent",node.func);search.setAttribute("ytrack",node.funcTracking);search.setAttribute("yfunc",node.funcNum);search.setAttribute("yhash",node.hash);var url=node.funcUrl;url=url.substring(1,url.indexOf(","));search.setAttribute("yurl",url);search.setAttribute("newlines","replacewithspaces");search.setAttribute("width",_mConfigManager.getIntValue("search.boxwidth"));var searchHash=yahooUtils.JSON.parse(node.hash);search.setAttribute("ylive",unescape(searchHash.live));search.setAttribute("class","yahoo-toolbar-search-box");search.setAttribute("ptfStyle",yahooUtils.formatStyleInformation(searchHash.ptf?searchHash.ptf:""));search.setAttribute("sbfStyle",yahooUtils.formatStyleInformation(searchHash.sbf?searchHash.sbf:""));if(searchHash.popup_url)_mConfigManager.setCharValue("search.popup_src",searchHash.popup_url,true);search.setAttribute("style",yahooUtils.formatStyleInformation(searchHash.ptf));search.setAttribute("value",searchHash.pt);search.yselect=true;dom.appendChild(search)}catch(e){yahooError("Error in _buildSearchBox "+e);}
return dom;}
function _buildTicker(node){var dom=null;try{dom=_mToolbarDocument.createElementNS(_mNS,"toolbaritem");dom.setAttribute("flex",1);var ticker=_mToolbarDocument.createElementNS(_mNS,"hbox");ticker.setAttribute("id","yahooToolbarTicker");ticker.setAttribute("yevent",node.func);ticker.setAttribute("ytrack",node.funcTracking);ticker.setAttribute("yfunc",node.funcNum);ticker.setAttribute("maxTickerWidth","200");ticker.setAttribute('onkeyup',"if(event.keyCode == event.DOM_VK_ENTER || event.keyCode == event.DOM_VK_RETURN){ _self.blurred(event, true); yahooButtonHandler(event); }");ticker.setAttribute("width",_mConfigManager.getIntValue("cna.tickerboxwidth"));ticker.setAttribute("flex",1);ticker.setAttribute("yhash",node.hash);dom.appendChild(ticker);}catch(e){yahooError("Error in _buildTicker () "+e);}
return dom;}
function _prepareTicker(dom,hash){dom.setAttribute("class","yahooToolbarTicker");dom.setAttribute("minwidth","50");}
function _processStyles(node,dom,hash){if(node.styles.indexOf("NOTEXT")>-1){dom.setAttribute("no_label","true");}
if(node.styles.indexOf("ALWAYSHIDE")>-1||node.id=="yahoo-toolbar-srch_hlt"){dom.setAttribute("hidden",true);}
if(node.id!==null&&node.styles.indexOf("REMOVEONCLICK")>-1){_self.removables[_self.removables.length]=dom;}
if(node.styles.indexOf("HIGHLIGHTICON")>-1&&node.icon){var icon=node.icon;var pos=icon.lastIndexOf(".");icon=icon.substr(0,pos)+"_h"+icon.substr(pos);dom.setAttribute("yicon_h",icon);dom.setAttribute("bgImage","");dom.setAttribute("bgImageNormal","");dom.setAttribute("bgImageHover","");dom.setAttribute("bgImagePress","");dom.setAttribute("pressEffect","false");}
if(node.styles.indexOf("MINIMIZABLE")>-1){dom.setAttribute("flex","1");}
dom.setAttribute("ystyles",node.styles);if(dom.ownerDocument.firstChild&&dom.ownerDocument.firstChild.id=="toolbar"&&node.type!=node.EDITBOX_TYPE&&node.styles.indexOf("NOTOOLTIP")==-1){dom.setAttribute("tooltiptext",unescape(node.name));if(hash.at){var tt="";var tooltip=unescape(hash.at);if(tooltip){tooltip=tooltip.replace(/%2525/g,"");tooltip=tooltip.replace(/%25/g,"");tooltip=tooltip.replace(/%|\$|,/g,"");dom.setAttribute("tooltiptext",tooltip);}}}}
function _prepareRightButtons(dom,node){if(node.id.indexOf("yahoo-toolbar-grp_")==-1){dom.setAttribute("no_label","true");dom.setAttribute("bgImage","");dom.setAttribute("bgImageNormal","");dom.setAttribute("bgImageHover","");dom.setAttribute("bgImagePress","");dom.setAttribute("pressEffect","false");dom.setAttribute("minwidth","28");}
if(node.id.indexOf("yahoo-toolbar-grp_")>-1){_mGroupBtns.appendChild(dom);return;}
if(node.id.indexOf("yahoo-toolbar-add_")>-1){var btn=_mRightSepImg.nextSibling;if(btn&&btn.getAttribute("id")=="yahoo-toolbar-vert_toggle_ff")
btn=btn.nextSibling;if(btn){_mRightAlignBtns.insertBefore(dom,btn);return;}}
_mRightAlignBtns.appendChild(dom);}
function _prepareGroupButton(dom,node){var iconHost="l.yimg.com",iconDir="\/a\/i\/tb\/icons";if(_mLocalStorage.getString("i")!=null){iconHost=_mLocalStorage.getString("i");}
if(_mLocalStorage.getString("iu")!=null){iconDir=_mLocalStorage.getString("iu");}
var skin_base="http:\/\/"+iconHost+iconDir+"\/";var grpImg=_mBaseGroupImage.split(".")[0];var grpImgExtn="."+_mBaseGroupImage.split(".")[1];var ecapImg=_mBaseEndCapImage.split(".")[0];var ecapImgExtn="."+_mBaseEndCapImage.split(".")[1];var GROUP_LEFT_IMG=skin_base+grpImg+"_lt"+grpImgExtn;var GROUP_RIGHT_IMG=skin_base+grpImg+"_rt"+grpImgExtn;var GROUP_BACKGROUND_IMG=skin_base+grpImg+"_bg"+grpImgExtn;var GROUP_LEFT_HOVER_IMG=skin_base+grpImg+"_lt_h"+grpImgExtn;var GROUP_RIGHT_HOVER_IMG=skin_base+grpImg+"_rt_h"+grpImgExtn;var GROUP_BACKGROUND_HOVER_IMG=skin_base+grpImg+"_bg_h"+grpImgExtn;var CAP_CLOSE_IMG=skin_base+ecapImg+"_s0"+ecapImgExtn;var CAP_OPEN_IMG=skin_base+ecapImg+"_s1"+ecapImgExtn;var CAP_CLOSE_HOVER_IMG=skin_base+ecapImg+"_s0_h"+ecapImgExtn;var CAP_OPEN_HOVER_IMG=skin_base+ecapImg+"_s1_h"+ecapImgExtn;var builder=_mGradientGenerator;dom.setAttribute("flex","1");dom.setAttribute("imageBg","");dom.setAttribute("image_bg_normal_extra","");dom.setAttribute("imageCenter",GROUP_RIGHT_IMG);dom.setAttribute("image_bg_normal_hover",GROUP_BACKGROUND_HOVER_IMG);dom.setAttribute("image_bg_normal",GROUP_BACKGROUND_IMG);dom.setAttribute("image_right_closed",CAP_CLOSE_IMG);dom.setAttribute("image_right_open",CAP_OPEN_IMG);dom.setAttribute("grp_bg_vert_text","background:url('"+GROUP_LEFT_IMG+"');cursor:pointer;color:"+_mColorGroupButtonText);dom.setAttribute("group_right_style","background:url('"+GROUP_LEFT_IMG+"');cursor:pointer;color:"+_mColorGroupButtonText);dom.setAttribute("grp_bg_style","cursor:pointer;background:url('"+GROUP_LEFT_IMG+"');padding-right:3px;padding-bottom:4px;color:"+_mColorGroupButtonText);dom.setAttribute("group_middle_style","cursor:inherit;background:url('"+GROUP_LEFT_IMG+" ');color:"+_mColorGroupButtonText);dom.setAttribute("group-internal-style","padding-left:0px;padding-right:0px;background:url('"+GROUP_LEFT_IMG+"');color:"+_mColorGroupButtonText);dom.setAttribute("style","margin-left:1px;color:"+_mColorGroupButtonText);}
function _prepareGroupButton_sports(dom){var builder=_mGradientGenerator;dom.setAttribute("imageBg",builder.GROUP_BUTTON_IMAGE_BACKGROUND_EXTRA);dom.setAttribute("imageCenter",builder.GROUP_BUTTON_MIDDLE);dom.setAttribute("image_bg_normal_extra",builder.GROUP_BUTTON_IMAGE_BACKGROUND_EXTRA);dom.setAttribute("image_bg_normal_hover",builder.GROUP_BUTTON_IMAGE_BACKGROUND_HOVER);dom.setAttribute("image_bg_normal",builder.GROUP_BUTTON_IMAGE_BACKGROUND);dom.setAttribute("image_right_closed",builder.GROUP_BUTTON_RIGHT_CLOSED);dom.setAttribute("image_right_open",builder.GROUP_BUTTON_RIGHT_OPEN);dom.setAttribute("group_right_style","background:url('"+builder.GROUP_BUTTON_RIGHT_CLOSED+"');cursor:pointer;color:"+_mColorGroupButtonText);dom.setAttribute("grp_bg_style","cursor:pointer;background:url('"+builder.GROUP_BUTTON_MIDDLE+"');padding-right:3px;padding-bottom:4px;color:"+_mColorGroupButtonText);dom.setAttribute("group_middle_style","cursor:inherit;background:url('"+builder.GROUP_BUTTON_MIDDLE+"');color:"+_mColorGroupButtonText);dom.setAttribute("group-internal-style","padding-left:2px;padding-right:0px;background:url('"+builder.GROUP_BUTTON_INTERNAL+"');color:"+_mColorGroupButtonText);dom.setAttribute("style","margin-left:3px;color:"+_mColorGroupButtonText);}
function _prepareNormalButton(dom,node){var builder=_mGradientGenerator;dom.setAttribute("bgImage","");dom.setAttribute("bgImageNormal","");dom.setAttribute("bgImageHover",builder.NORMAL_BUTTON_HOVER);dom.setAttribute("bgImagePress",builder.NORMAL_BUTTON_PRESS);dom.setAttribute("arrowUpImage",_mGradientGenerator.DROPDOWN_ARROW_UP);dom.setAttribute("arrowDownImage",_mGradientGenerator.DROPDOWN_ARROW_DOWN);dom.setAttribute("arrowImageStyle",_mGradientGenerator.DROPDOWN_ARROW_DOWN);if(node.id=="yahoo-toolbar-vsrch"||node.id=="yahoo-toolbar-fin_quotes"){dom.setAttribute("buttonTextColor",_mColorSearchButtonText);dom.setAttribute("arrowUpImage",_mGradientGenerator.BLACK_DROPDOWN_ARROW_UP);dom.setAttribute("arrowDownImage",_mGradientGenerator.BLACK_DROPDOWN_ARROW_DOWN);dom.setAttribute("arrowImageStyle",_mGradientGenerator.BLACK_DROPDOWN_ARROW_DOWN);}else{dom.setAttribute("buttonTextColor",_mColorButtonText);dom.setAttribute("iconLabelStyle","padding-left:3px;padding-right:1px;color:"+_mColorButtonText);}}
function _setDomFont(dom,value){var fontParams=value.split(";")
for(var idx=0;idx<fontParams.length;idx++){var kv=fontParams[idx].split(":");switch(kv[0]){case"c":dom.style.color=kv[1];break;case"ff":dom.style.fontFamily=kv[1];break;case"fs":dom.style.fontSize=""+(parseInt(kv[1])+2)+"px";break;case"fw":var weight="normal"
if(kv[1]=="b"){weight="bold";}
dom.style.fontWeight=weight;break;}}}
function _processYHash(node,dom,hash){var iconHost="l.yimg.com",iconDir="\/a\/i\/tb\/icons";if(_mLocalStorage.getString("i")!=null){iconHost=_mLocalStorage.getString("i");}
if(_mLocalStorage.getString("iu")!=null){iconDir=_mLocalStorage.getString("iu");}
_mImagePath="http:\/\/"+iconHost+iconDir+"\/";for(name in hash){var value=hash[name];var idx=0;switch(name){case"f_1":case"f_2":case"f_0":case"f":_setDomFont(dom,value);break;case"backn":dom.setAttribute("bgImage",_mImagePath+value);dom.setAttribute("bgImageNormal",_mImagePath+value);dom.setAttribute("bgImageHover",_mImagePath+value);dom.setAttribute("bgImagePress",_mImagePath+value);break;case"backp":dom.setAttribute("bgImagePress",_mImagePath+value);break;case"backh":dom.setAttribute("bgImageHover",_mImagePath+value);break;case"gedge":dom.style.margin=""+value+"px";break;case"width":dom.setAttribute("y_width",value);break;case"minw":dom.setAttribute("y_min_width",value);dom.setAttribute("y_grp_min_width",value-60);break;case"maxw":dom.setAttribute("y_max_width",value);dom.setAttribute("y_grp_max_width",value-60);break;}}}
function _processBookmarks(node,hash){if(node.id=="yahoo-toolbar-boo"&&hash.bmfeed){_self.bm2Feed=unescape(hash.bmfeed);if(hash.bmfoldersave){yahooDebug("Has bmfoldersave: "+hash.bmfoldersave);_self.bm2FolderSave=unescape(hash.bmfoldersave);}else{yahooDebug("NO bmboldersave");}
if(hash.bmimporturl){_self.bm2FFBMImportUrl=unescape(hash.bmimporturl);yahooDebug("Has bmimporturl: "+hash.bmimporturl);}
yahooDebug("FEED: "+_self.bm2Feed);}
if("yahoo-toolbar-boo_m/boo_m_6/boo_m_6_1"==node.id&&hash.bmimport){if(hash.bmimport){_self.bm2FFBMImportCrumb=unescape(hash.bmimport);yahooDebug("Has bmimport: "+hash.bmimport);}}}
function _makeDomAccessible(dom){dom.setAttribute("tabindex",_mTabIndex++);dom.setAttribute("accesibileType",1023);}
function _createToolbarChild(node,parent,hash){var dom=parent.ownerDocument.createElementNS(_mNS,"toolbarbutton");var popup=null;switch(node.type){case node.BUTTON_TYPE:dom.setAttribute("class","lightning-button");if(node&&node.id&&node.id.indexOf("yahoo-toolbar-ecap_grp")>-1){_mInsideGroup=false;dom=parent.ownerDocument.createElementNS(_mNS,"checkbox");dom.setAttribute("class","lightning-expand-button");}
if(node&&node.id&&node.id.indexOf("yahoo-toolbar-spt_liv")>-1){dom.setAttribute("type","live-button");}
break;case node.SIZER_TYPE:dom=parent.ownerDocument.createElementNS(_mNS,"splitter");dom.setAttribute("hidden","false");dom.setAttribute("resizebefore","flex");dom.setAttribute("resizeafter","grow");break;case node.GROUP_TYPE:if(node.id.indexOf("grp_")>=0){dom=parent.ownerDocument.createElementNS(_mNS,"toolbaritem");dom.setAttribute("maxheight","32");dom.setAttribute("class","yahoo-toolbar-group-button");popup=dom.appendChild(parent.ownerDocument.createElementNS(_mNS,"menupopup"));popup.setAttribute("style",_mPopupStyle);popup.setAttribute("position","after_end");popup.setAttribute("id","yahoo-toolbar-vert-popup");if(node.id.indexOf("grp_cna")>=0){_mCNADom=dom;_mCNADom.setAttribute("enableCompleteExpansion","false");}else{_mInsideGroup=true;_mFAVDom=dom;_mFAVDom.setAttribute("enableCompleteExpansion","false");_self.groupId=node.id;if(_self.groupId.indexOf("yahoo-toolbar-")==0){_self.groupId=_self.groupId.substr(14);}}
_prepareGroupButton(dom,node);}
break;case node.BUTTONSLIDEOUT_TYPE:if(node.name=="Ticker"){dom=_buildTicker(node);}else{if(node&&node.id&&hash.ysoid){dom.setAttribute("type","menu-slideout");}}
break;case node.BUTTONMENU_TYPE:case node.MODULE_TYPE:case node.MODULEMENU_TYPE:dom.setAttribute("type",_mInsideGroup?"menu-button-group":"menu-button");popup=dom.appendChild(parent.ownerDocument.createElementNS(_mNS,"menupopup"));popup.setAttribute("style",_mPopupStyle);if(node&&node.id&&node.id.indexOf("yahoo-toolbar-vsrch")>=0){dom.setAttribute("class","ytff-button-search");}
break;case node.MENU_TYPE:dom.setAttribute("type","menu");popup=dom.appendChild(parent.ownerDocument.createElementNS(_mNS,"menupopup"));popup.setAttribute("style",_mPopupStyle);break;case node.MENUITEM_TYPE:break;case node.EDITBOX_TYPE:dom=_buildSearchBox(node);break;case node.SEPARATOR_TYPE:dom=null;dom=parent.ownerDocument.createElementNS(_mNS,"toolbarseparator");if(node.id=="yahoo-toolbar-spt_sep")
{dom.setAttribute("class","lightning-toolbar-separator");}else{dom.setAttribute("class","lightning-toolbar-null-separator");}
break;default:dom=null;}
if(popup){popup.style.color="black";}
return{domNode:dom,popupNode:popup};}
function _createNonToolbarChild(node,parent){var dom=parent.ownerDocument.createElementNS(_mNS,"menuitem");var popup=null;switch(node.type){case node.MENUITEM_TYPE:case node.BUTTON_TYPE:case node.BUTTONSLIDEOUT_TYPE:case node.GROUP_TYPE:break;case node.BUTTONMENU_TYPE:case node.MENU_TYPE:case node.MODULE_TYPE:case node.MODULEMENU_TYPE:dom=parent.ownerDocument.createElementNS(_mNS,"menu");popup=dom.appendChild(parent.ownerDocument.createElementNS(_mNS,"menupopup"));break;case node.SEPARATOR_TYPE:dom=parent.ownerDocument.createElementNS(_mNS,"menuseparator");break;case node.EDITBOX_TYPE:dom=null;default:dom=null;}
return{domNode:dom,popupNode:popup};}
function _createMenuDom(node,dom){var mdom=null,mpopup=null;var _filter="yahoo-toolbar-srch_ebox,yahoo-toolbar-vsrch,yahoo-toolbar-sep_grp_fav,yahoo-toolbar-grp_spt,yahoo-toolbar-pres,yahoo-toolbar-spr";_filter+="yahoo-toolbar-score_tic,yahoo-toolbar-spo_tic,yahoo-toolbar-size_grp_spt";_filter+="yahoo-toolbar-capsrch";if(node.id&&_filter.indexOf(node.id)==-1&&node.id.indexOf("ult")==-1){switch(dom.nodeName){case"toolbarbutton":switch(dom.getAttribute("type")){case"menu-button-group":case"menu-button":mdom=_mDocument.createElementNS(_mNS,"menu");mpopup=mdom.appendChild(_mDocument.createElementNS(_mNS,"menupopup"));mdom.setAttribute("label",node.name);if(node.id){mdom.setAttribute("id","menu_"+node.id);}
mdom=mpopup.appendChild(_mDocument.createElementNS(_mNS,"menuitem"));mpopup.appendChild(_mDocument.createElementNS(_mNS,"menuseparator"));break;case"menu":mdom=_mDocument.createElementNS(_mNS,"menu");mpopup=mdom.appendChild(_mDocument.createElementNS(_mNS,"menupopup"));break;case"":if(dom.getAttribute("yfunc")=="4")
mdom=_mDocument.createElementNS(_mNS,"menuitem");break;default:mdom=_mDocument.createElementNS(_mNS,"menuitem");}
if(node.styles.indexOf("ALWAYSHIDE")>-1&&mdom){mdom.setAttribute("hidden","true");}
break;case"toolbarseparator":mdom=_mDocument.createElementNS(_mNS,"menuseparator");break;}}
return{mdomNode:mdom,mpopupNode:mpopup};}
function _prepareMenuDom(node,mdom,mpopup,dom,popup){if(node.id){if(node.type==node.BUTTONMENU_TYPE){mdom.setAttribute("id","menu_"+node.id+"_btn");}else{mdom.setAttribute("id","menu_"+node.id);}}
mdom.removeAttribute("class");mdom.removeAttribute("contextmenu");mdom.removeAttribute("tooltiptext");mdom.setAttribute("class","menuitem-iconic");mdom.style.display=dom.style.display;if(node.type==node.BUTTONMENU_TYPE||node.type==node.MODULE_TYPE||node.type==node.MODULEMENU_TYPE){mdom=mpopup.parentNode;}
if(node.id&&node.styles.indexOf("REMOVEONCLICK")>-1){_self.removables[_self.removables.length]=dom;}
if(node.hash=="")node.hash="{}";var hash=node.hash;var sk=yahooUtils.JSON.parse(hash);if(node.parentNode&&node.parentNode.domMenubar&&node.styles.indexOf("ALWAYSHIDE")<0){node.parentNode.domMenubar.appendChild(mdom);}else if(!node.parentNode&&node.styles.indexOf("ALWAYSHIDE")<0){if(!(node.hash&&sk.menubarshow=="false"))
_self.menubar.appendChild(mdom);}
node.domMenubar=mpopup||mdom;}
function _iWantToDoAWorkAround(node,dom,hash){if(node.id=="yahoo-toolbar-rss"||node.id=="yahoo-toolbar-rss_m"||node.id=="yahoo-toolbar-RSS"||node.id=="menu_yahoo-toolbar-rss"||node.id=="menu_yahoo-toolbar-rss_m"||node.id=="menu_yahoo-toolbar-RSS"){dom.style.display="none";}
if(node.id=="yahoo-toolbar-cm-sio"){dom.setAttribute("type","checkbox");}
if(dom.parentNode==_mFAVDom&&dom.setAttribute&&!hash.ysoid&&!hash.ysoxx){dom.setAttribute("imgHeight","22");dom.setAttribute("imgWidth","22");}
if(node&&((node.styles&&node.styles.indexOf("EX_RIGHTJUSTIFYBAND")>-1)||(node.id&&node.id.indexOf("yahoo-toolbar-add_")>-1))){_prepareRightButtons(dom,node);}
if(dom.tagName=="toolbarbutton"&&!(node&&node.id&&node.id.indexOf("yahoo-toolbar-vsrch")>=0)){dom.setAttribute("class","lightning-button");}
if(dom.getAttribute("id").indexOf("group")==-1&&dom.getAttribute("id").indexOf("grp")==-1){}
if(_self.iconsOnly===true){}
if(node.icon!==null&&node.icon!==""){dom.setAttribute("yicon",node.icon);_mFileIO.fetchNCacheImage(node.icon,dom);if(dom.tagName=="menuitem"&&dom.className==""){dom.className+="menuitem-iconic";}else if(dom.tagName=="menu"){dom.className+="menu-iconic";}}
else if(node.icon===null||node.icon===""){}
if(node.id=="yahoo-toolbar-yma_m"){var img="alert1.gif";if(hash!=undefined&&hash.ovimg){img=hash.ovimg;}
var path=node.icon;var pos=path.lastIndexOf("/");if(pos>10){path=path.substr(0,pos+1);}else{path="http:\/\/l.yimg.com/a/i/tb/iconsgif/";if(_mLocalStorage.getString("ig")!=null){path="http:\/\/"+_mLocalStorage.getString("ig")+"\/";}}
dom.setAttribute("ovimg",path+img);}
if(node&&node.id&&node.id.indexOf("_tic")>-1){_prepareTicker(dom,hash);}
if(node&&node.id&&node.id.indexOf("size_grp_")>-1){dom.style.display="none";}
if(node&&node.id&&node.id.indexOf("ecap_grp_")>-1){dom.style.display="none";}
if(dom.tagName=="toolbarbutton"&&node&&node.id&&node.id.indexOf("yahoo-toolbar-spo_gallery_tic")>=0){dom.setAttribute("class","lightning-button");dom.setAttribute("type","group-gallery");dom.setAttribute("width","20px");dom.setAttribute("maxwidth","20px");dom.setAttribute("minwidth","20px");}
if(dom.tagName=="toolbarbutton"&&node&&node.id&&node.id.search(/yahoo-toolbar-[a-z]*_skin/ig)>=0){dom.setAttribute("class","ytff-button-highlighticon");dom.setAttribute("type","");}
if(dom.tagName=="toolbarbutton"&&node&&node.styles.indexOf("HIDEARROW")>=0&&node.styles.indexOf("HIGHLIGHTICON")>=0){dom.setAttribute("class","ytff-button-highlighticon-hidearrow");dom.setAttribute("type",node.type===node.MENU_TYPE?"menu":"");}}
function _setDirectDomAttributes(node,dom){dom.setAttribute("id",node.id);dom.setAttribute("label",node.name);dom.setAttribute("yhash",node.hash);if(node.type==node.BUTTON_TYPE||node.type==node.MENUITEM_TYPE||node.type==node.BUTTONMENU_TYPE||node.type==node.BUTTONSLIDEOUT_TYPE||node.type==node.MODULE_TYPE||node.type==node.MODULEMENU_TYPE||node.type==node.GROUP_TYPE){if(!dom.hasAttribute("oncommand")){dom.setAttribute("oncommand","yahooButtonHandler(event);");if(!(dom.tagName=="menuitem"||dom.tagName=="menu")){dom.setAttribute("onclick","if(event.button == 1) yahooButtonHandler(event);");}}
if(node.funcTracking==-1&&node.funcNum==0){dom.setAttribute("type","checkbox");dom.setAttribute("class","menuitem-iconic");dom.setAttribute("autocheck","false");dom.setAttribute("checked","true");node.icon=null;}
if(node.funcNum==9){dom.setAttribute("type","checkbox");dom.setAttribute("class","menuitem-iconic");dom.setAttribute("autocheck","false");node.icon=null;}
dom.setAttribute("yevent",node.func);dom.setAttribute("ytrack",node.funcTracking);dom.setAttribute("yfunc",node.funcNum);if(node.funcUrl!==null&&node.funcUrl!==""){var url=node.funcUrl;if((url.match("%")!==null)&&(url.match("$")!==null)){var prefs=CC["@mozilla.org/preferences-service;1"].getService(CI.nsIPrefBranch);var pc=_mConfigManager.getCharValue("toolbar.pc")||"";var cc=_mConfigManager.getCharValue("installer.country")+"."||"us.";var lang=_mConfigManager.getCharValue("installer.language")||cc.substr(0,2);var cver=_mConfigManager.getCharValue("installer.version")||"1.1.0";url=url.replace("%","");url=url.replace(",$FSRV,%",_mLocalStorage.getString("yahoo.ytff.dataserver.url"));url=url.replace(",$ESRV,%",_mLocalStorage.getString("yahoo.ytff.configserver.url"));url=url.replace(",$LANG,%",lang);url=url.replace(",$REG_pc,%",pc);url=url.replace(",$CVER,%",cver);}
dom.setAttribute('yurl',url);}}}
function _getParent(node,parent,hash){var toolbar=false;if(parent===null){parent=_self.toolbar;toolbar=true;if(node.id=="yahoo-toolbar-cm"){parent=_self.toolar_context;toolbar=false;}else if(node.id=="yahoo-toolbar-rmc_m"){parent=_self.page_context;toolbar=false;}else if(node.id=="yahoo-toolbar-acs"){_self.menubarExtra.appendChild(_mDocument.createElementNS(_mNS,"menuseparator"));return _self.menubarExtra;}else{if(node.id&&node.id.indexOf("yahoo-toolbar-fin_quotes")>-1){parent=_mReqBtns;}else if(_mFAVDom!=null&&node&&(node.id&&(node.id.indexOf("yahoo-toolbar-ecap_")!=-1||_self.groupId.indexOf(hash.grp)!=-1))||_mInsideGroup==true){if(hash.grp!=_self.groupId){node.hash="{\"grp\":\""+_self.groupId+"\","+node.hash.substr(1);}
parent=_mFAVDom;}else if(_mBtns.childNodes.length>0){parent=_mBtns;}else if(node.type==node.SEPARATOR_TYPE||(_mReqBtns.lastChild&&(_mReqBtns.lastChild.getAttribute("id")=="yahoo-toolbar-vsrch"||_mReqBtns.lastChild.getAttribute("id")=="yahoo-toolbar-fin_quotes"))){parent=_mBtns;}else if(node.id&&node.id.indexOf("yahoo-toolbar-pres")>-1){parent=_mRightAlignBtns;}else
{parent=_mReqBtns;}}}else if(parent==_self.alerts){toolbar=true;}
return{isToolbar:toolbar,parentNode:parent};}
this.toolbar=null;this.menubar=null;this.toolar_context=null;this.page_context=null;this.removables=[];this.bookmarks=null;this.bm2Feed=null;this.bm2Usage=[];this.bm2Prefs=[];this.bm2FolderSave=null;this.bm2FFBMImportCrumb=null;this.bm2FFBMImportUrl=null;this.iconsOnly=false;this.groupId="";this.groupLayout="";this.addNode=function(node,parent){var dom,popup;try{if(node&&node.id&&(node.id=='yahoo-toolbar-spr')){return;}
node.name=unescape(node.name);if(node.hash=="")node.hash="{}";var hash=yahooUtils.JSON.parse(node.hash);try{if(node.id){var id=node.id;if(id.indexOf("yahoo-toolbar-")==0){id=id.substr(14);}
_mLocalStorage.putObject(node.type==node.SKIN_TYPE?"yahoo-toolbar-skin.yhash":node.id+".yhash",new WrapperClass(hash));}}catch(e){yahooError(e);}
var result=_getParent(node,parent,hash);parent=result.parentNode;var product={domNode:null,popupNode:null};if(result.isToolbar){product=_createToolbarChild(node,parent,hash);}else{product=_createNonToolbarChild(node,parent);}
dom=product.domNode;popup=product.popupNode;if(dom==null){return null;}
_prepareNormalButton(dom,node);if(node.id&&((_self.groupId!=""&&hash&&hash.grp==_self.groupId)||_mInsideGroup)){var id=node.id;if(id.indexOf("yahoo-toolbar-")==0)id=id.substr(14);_self.groupLayout+=id+",";}
_setDirectDomAttributes(node,dom);_processYHash(node,dom,hash);_processBookmarks(node,hash);if(dom.ownerDocument.firstChild&&dom.ownerDocument.firstChild.id=="toolbar"&&node.funcNum=="1"&&parent.parentNode&&parent.parentNode.id!="yahoo-toolbar-boo"){parent.parentNode.setAttribute("id","yahoo-toolbar-bookmarks-"+(node.funcTracking||1));}
parent.appendChild(dom);_processStyles(node,dom,hash);_iWantToDoAWorkAround(node,dom,hash);if(dom.ownerDocument.firstChild&&dom.ownerDocument.firstChild.id=="toolbar"){dom.setAttribute("contextmenu","yahoo-toolbar-context");}
var _skip="yahoo-toolbar-add_grp_fav,yahoo-toolbar-ecap_grp_fav,yahoo-toolbar-ecap_grp_spt,yahoo-toolbar-add_grp_fav82,";_skip+="yahoo-toolbar-score_tic,yahoo-toolbar-spo_tic,yahoo-toolbar-size_grp_spt,yahoo-toolbar-size_grp_vert,yahoo-toolbar-ecap_grp_vert";_skip+="yahoo-toolbar-spt_liv";if(dom.ownerDocument.firstChild&&dom.ownerDocument.firstChild.id=="toolbar"){var mdom,mpopup;if(node.id&&(node.id.indexOf("yahoo-toolbar-ult")>-1||_skip.indexOf(node.id)>-1)){}
else if(dom.nodeName.indexOf("toolbar")===0){product=_createMenuDom(node,dom);mdom=product.mdomNode;mpopup=product.mpopupNode;if(mdom){var attr;for(var i=0;i<dom.attributes.length;i++){attr=dom.attributes[i];if(_mSkipAttrs[attr.name]!=1){mdom.setAttribute(attr.name,attr.value);}}}}
else{if(parent.parentNode.id.indexOf("yahoo-toolbar-ult")==-1){mdom=_mDocument.createElementNS(_mNS,dom.nodeName);if(dom.nodeName==="menu"){mpopup=mdom.appendChild(_mDocument.createElementNS(_mNS,"menupopup"));}
for(var idx=0;idx<dom.attributes.length;idx++){attr=dom.attributes[idx];mdom.setAttribute(attr.name,attr.value);}
if(popup){mpopup=mdom.firstChild;}}}
if(mdom){_prepareMenuDom(node,mdom,mpopup,dom,popup);}}}catch(e){yahooError(e);}
if(popup){if(dom){try{popup.setAttribute("yhash",dom.getAttribute("yhash"));}catch(e){yahooError(e);}}
dom=popup;}
if(dom!=null){_collectAlertData(dom);}
mdom=null;mpopup=null;popup=null;node=null;return dom;}
this.setSkinParams=function(node){if(node){var hash=node.hash;hash=hash.replace(/%2F/g,"/");hash=hash.replace(/%23/g,"#");yahooDebug(hash);var sk=yahooUtils.JSON.parse(hash);var iconHost="l.yimg.com",iconDir="\/a\/i\/tb\/icons";if(_mLocalStorage.getString("i")!=null){iconHost=_mLocalStorage.getString("i");}
if(_mLocalStorage.getString("iu")!=null){iconDir=_mLocalStorage.getString("iu");}
var skin_base="http:\/\/"+iconHost+iconDir+"\/";_mContainer.style.background="url('"+skin_base+sk.skin_bk
+"') repeat-x ";_mReqBtns.style.background="url('"+skin_base+sk.skin_left
+"') no-repeat";_mGroupButtonTextColor="black";_mButtonTextColor="black";if(sk.skin_g_t_col){_mColorGroupButtonText=sk.skin_g_t_col;}
if(sk.skin_t_col){_mColorButtonText=sk.skin_t_col;}
_mColorSearchButtonText="black";if(sk.skin_s_t_col){_mColorSearchButtonText=sk.skin_s_t_col;}
_mReqBtns.style.paddingLeft=sk.skin_ofs+"px";_mGradientGenerator.setGroupGradient(""+sk.skin_c_bdrdk,""+sk.skin_c_bdrlt);_mGradientGenerator.setInternalGradient(""+sk.skin_g_bgtop,""+sk.skin_g_bgbot);_mGradientGenerator.setArrowColor(sk.skin_drop_col);_mGradientGenerator.initGradients();var url=_mGradientGenerator.TOOLBAR_BACKGROUND;var tbStyle="background:url('"+url+"') repeat-x;padding:0px !important;margin:0px!important;border:none ! important";if(sk.skin_bk==""){_mContainer.setAttribute("style",tbStyle);}
if(sk.skin_icons&&sk.skin_icons!=""){var _NewStyleBtns=sk.skin_icons.split(";");for(var i=0;i<_NewStyleBtns.length;i++){switch(_NewStyleBtns[i].split(":")[0]){case"{grp_bc}":_mBaseGroupImage=_NewStyleBtns[i].split(":")[1];break;case"{grp_ec}":_mBaseEndCapImage=_NewStyleBtns[i].split(":")[1];break;default:break;}}}else{_mBaseGroupImage="skins/noskin_grp.png";_mBaseEndCapImage="skins/noskin_ec.png";}}}
this.clear=function(){try{_self.removables=[];_self.toolbar=null;_self.menubar=null;_self.menubarExtra=null;_self.toolar_context=null;_self.page_context=null;_self.alerts=null;_self.groupId="";_self.groupLayout="";_mCNADom=null;_mFAVDom=null;_mReqBtns=null;_mBtns=null;_mRightAlignBtns=null;_mTabIndex=50;_self.toolbar=_mToolbarDocument.createDocumentFragment();_self.menubar=_mDocument.createDocumentFragment();_self.menubarExtra=_mDocument.createDocumentFragment();_self.toolar_context=_mDocument.createDocumentFragment();_self.page_context=_mDocument.createDocumentFragment();_self.alerts=_mDocument.createDocumentFragment();_mReqBtns=_mToolbarDocument.createElementNS(_mNS,"toolbaritem");_mReqBtns.id="yahoo-toolbar-reqbtns";_mReqBtns.setAttribute("maxwidth","700");_mReqBtns.setAttribute("pack","begin");_mReqBtns.setAttribute("align","center");var splitter=_createSplitter();_mBtns=_mToolbarDocument.createElementNS(_mNS,"toolbaritem");_mBtns.id="yahoo-toolbar-btns";_mBtns.setAttribute("style","margin-left:3px");_mBtns.setAttribute("maxheight","32");var moreMenu=_mToolbarDocument.createElementNS(_mNS,"toolbarbutton");moreMenu.setAttribute("class","yahoo-toolbar-more-menu-class");moreMenu.id="yahoo-toolbar-moremenu";moreMenu.setAttribute("hidden","true");moreMenu.setAttribute("maxwidth","20");moreMenu.setAttribute("minwidth","20");moreMenu.setAttribute("type","menu");var flexBox=_mToolbarDocument.createElementNS(_mNS,"toolbaritem");flexBox.id="yahoo-toolbar-flexbox";flexBox.setAttribute("flex","10000");var grpSplitter=_mToolbarDocument.createElementNS(_mNS,"splitter");grpSplitter.id="yahoo-toolbar-group-splitter";grpSplitter.setAttribute("resizebefore","flex");grpSplitter.setAttribute("resizeafter","flex");grpSplitter.setAttribute("height","40");grpSplitter.setAttribute("class","groupbox-splitter");_mGroupBtns=_mToolbarDocument.createElementNS(_mNS,"toolbaritem");_mGroupBtns.id="yahoo-toolbar-group-btns";_mGroupBtns.setAttribute("align","right");_mGroupBtns.setAttribute("flex","1");_mGroupBtns.setAttribute("maxwidth","495");_mGroupBtns.setAttribute("minwidth","50");_mRightAlignBtns=_mToolbarDocument.createElementNS(_mNS,"toolbaritem");_mRightAlignBtns.id="yahoo-toolbar-right-btns";_mRightAlignBtns.setAttribute("align","right");_mRightAlignBtns.setAttribute("style","margin:0px!important;padding-bottom:2px;border:0px!important");_mRightSepImg=_mToolbarDocument.createElementNS(_mNS,"image");_mRightSepImg.setAttribute("id","yahoo-toolbar-addsep");_mRightSepImg.setAttribute("src","chrome://ytoolbar/skin/add_separator.png");_mRightSepImg.setAttribute("style","margin:0px;opacity:0.5;padding-top:2px;margin-right:2px;padding-left:4px;");_mRightSepImg.setAttribute("hidden","true");_mRightAlignBtns.appendChild(_mRightSepImg);_mContainer=_mToolbarDocument.createElementNS(_mNS,"toolbaritem");_mContainer.id="yahoo-toolbar-main-container";_mContainer.setAttribute("maxheight","30");_mContainer.setAttribute("flex","2");_mContainer.setAttribute("style","margin-right:3px;margin-left:3px;");_mContainer.appendChild(_mReqBtns);_mContainer.appendChild(splitter);_mContainer.appendChild(_mBtns);_mContainer.appendChild(moreMenu);_mContainer.appendChild(flexBox);_mContainer.appendChild(grpSplitter);_mContainer.appendChild(_mGroupBtns);_mContainer.appendChild(_mRightAlignBtns);_self.toolbar.appendChild(_mContainer);var node={hash:"{\"skin_bk\":\"\",\"skin_left\":\"\",\"skin_ofs\":0,"+"\"skin_g_bgtop\":\"#505050\",\"skin_g_bgbot\":\"#888888\",\"skin_c_bdrdk\":\"#AAAAAA\",\"skin_c_bdrlt\":\"#EEEEEE\","+"\"skin_c_grddk\":\"#FF0000\",\"skin_c_grdlt\":\"#00FF00\",\"skin_t_col\":\"#000000\","+"\"skin_g_t_col\":\"#000000\",\"skin_s_bgcol\":\"#000000\",\"skin_s_t_col\":\"#000000\"}"};_self.setSkinParams(node);}catch(e){yahooError(e);}};this.remove=function(id){try{var nId;for(var i=0;i<_self.removables.length;i++){if(_self.removables[i]&&_self.removables[i].parentNode&&(_self.removables[i].id==id||_self.removables[i].id=="menu_"+id||_self.removables[i].id=="menu_"
+id+"_btn")){_self.removables[i].parentNode.removeChild(_self.removables[i]);_self.removables[i]=null;}}}catch(e){yahooError(e);}};this.clearBM2=function(){try{_self.bookmarks=null;_self.bookmarks=_mDocument.createDocumentFragment();}catch(e){yahooError(e);}};this.buildBM2=function(dom,parent){var recursionBase=(parent===null);var yahooStr=_mLocalStorage.getObject("yahoo-toolbar-boo.yhash");try{if(!parent){parent=_self.bookmarks;}
var uni=CC["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(CI.nsIScriptableUnicodeConverter);uni.charset="utf-8";var node,name,type,url,menu,menupopup,menuitem,str;for(var i=0;i<dom.childNodes.length;i++){node=dom.childNodes[i];if(node.nodeName!="outline"){continue;}
type=node.getAttribute("type");url=node.getAttribute("u");name=uni.ConvertToUnicode(node.getAttribute("text"));name=unescape(name);switch(type){case"F":if(node.getAttribute("text")=="root"&&node.parentNode&&node.parentNode.getAttribute("type")=="ResultSet"){_self.buildBM2(node,parent);}
else if(node.getAttribute("text")=="tags"&&_self.bm2Prefs.DisplayFoldersAs=="TagView"&&node.getAttribute("fid")=="-1"){_self.buildBM2(node,parent);}else{menu=_mDocument.createElementNS(_mNS,"menu");menu.setAttribute("crop","end");menu.setAttribute("label",name);menu.setAttribute("tooltiptext",name);menu.setAttribute("onclick","if(event.button == 1) {yahooBookmarksOpenAll(_self.firstChild); yahooButtonHandler(event);}");menu.setAttribute("maxwidth","300px");if(_self.bm2Prefs.DisplayFoldersAs=="TagView"){menu.setAttribute("class","menu-iconic");menu.setAttribute("image","chrome://ytoolbar/skin/tag.gif");}else{menu.setAttribute("class","menu-iconic folder-item");}
menupopup=_mDocument.createElementNS(_mNS,"menupopup");if(_self.bm2FolderSave){var nameStr=name.replace(/\$/g,"$$$$");if(yahooStr!==null){str=yahooStr.wrappedJSObject.object["yahoo.bm.folder.add"].replace("__TITLE__",nameStr);}else{str="Add page to __TITLE__";str=str.replace("__TITLE__",nameStr);}
menuitem=_mDocument.createElementNS(_mNS,"menuitem");menuitem.setAttribute("crop","end");menuitem.setAttribute("label",str);menuitem.setAttribute("tooltiptext",str);menupopup.appendChild(menuitem);menupopup.appendChild(_mDocument.createElementNS(_mNS,"menuseparator"));var func=_self.bm2FolderSave;menuitem.setAttribute("yevent",_self.bm2FolderSave.replace("__FOLDERID__",node.getAttribute("fid")));menuitem.setAttribute("yhash","'id':'boo2_m/fold_add'");menuitem.setAttribute("oncommand","yahooButtonHandler(event);");menuitem.setAttribute("onclick","if(event.button == 1) yahooButtonHandler(event);");}
_self.buildBM2(node,menupopup);var nodeB=menupopup.firstChild;var urlYes=0;while(nodeB){if(nodeB.getAttribute("yurl")&&nodeB.getAttribute("yurl")){urlYes++;}
nodeB=nodeB.nextSibling;}
if(urlYes>=1){var nameStr=name.replace(/\$/g,"$$$$");if(yahooStr!==null){str=yahooStr.wrappedJSObject.object["yahoo.bm.folder.open"];}else{str="Open in Tabs";}
menupopup.appendChild(_mDocument.createElementNS(_mNS,"menuseparator"));menuitem=_mDocument.createElementNS(_mNS,"menuitem");menuitem.setAttribute("crop","end");menuitem.setAttribute("label",str);menuitem.setAttribute("tooltiptext",str);menuitem.setAttribute("yhash","'id':'boo2_m/fold_tabs'");menuitem.setAttribute("oncommand","yahooBookmarksOpenAll(this.parentNode); yahooButtonHandler(event);");menuitem.setAttribute("onclick","if(event.button == 1) {yahooBookmarksOpenAll(this.parentNode); yahooButtonHandler(event);}");menuitem.setAttribute("maxwidth","300px");menupopup.appendChild(menuitem);}
if(menupopup.childNodes.length<=2){menupopup.removeChild(menupopup.childNodes[1]);}
menu.appendChild(menupopup);parent.appendChild(menu);}
break;case"B":if((node.parentNode.getAttribute("type")=="RecentSave"||node.parentNode.getAttribute("type")=="FrequentUse")&&((node.parentNode.getAttribute("type")==_self.bm2Prefs.OrderBy&&parent.childNodes.length
-1==_self.bm2Prefs.ToolbarDisplay)||parent.childNodes.length==_self.bm2Prefs.ToolbarDisplay)){break;}
menuitem=_mDocument.createElementNS(_mNS,"menuitem");menuitem.setAttribute("crop","end");menuitem.setAttribute("label",name);menuitem.setAttribute("value",node.getAttribute("u"));menuitem.setAttribute("contextmenu","yahoo-toolbar-context");menuitem.setAttribute("tooltiptext",name);url=url.replace(/,/g,"%2C");menuitem.setAttribute("yevent",",4,boo_m,%"+url);menuitem.setAttribute("ytrack","boo_m");menuitem.setAttribute("yfunc","4");menuitem.setAttribute('yurl',url);menuitem.setAttribute('ybid',node.getAttribute("bid"));menuitem.setAttribute("oncommand","yahooButtonHandler(event);");menuitem.setAttribute("onclick","if(event.button == 1) yahooButtonHandler(event);");menuitem.setAttribute("class","menuitem-iconic bookmark-item");if((_self.bm2Prefs.OrderBy=="RecentlySaved"&&node.parentNode.getAttribute("type")=="RecentSave")||(_self.bm2Prefs.OrderBy=="FrequentlyAccessed"&&node.parentNode.getAttribute("type")=="FrequentUse")){_mFileIO.fetchNCacheFavicon(url,menuitem);}else{var bImage=_mFileIO.getFaviconFromCache(url,true);menuitem.setAttribute("image",bImage);}
parent.appendChild(menuitem);break;case"Toolbar":var d;for(var n=0;n<node.childNodes.length;n++){d=node.childNodes[n];if(d.nodeName=="outline"&&d.getAttribute("type")=="Pref"){_self.bm2Prefs[d.getAttribute("text")]=d.getAttribute("a");}}
break;case"RecentSave":if((_self.bm2Prefs.ToolbarDisplay-1)===0||node.getAttribute("total")=="0"){break;}
var recent;if(yahooStr!==null){recent=yahooStr.wrappedJSObject.object["yahoo.bm.quick.recent"];}else{recent="Recently Saved";}
if(_self.bm2Prefs.OrderBy=="RecentlySaved"){var frag=_mDocument.createDocumentFragment();frag.appendChild(_mDocument.createElementNS(_mNS,"menuitem"));frag.lastChild.setAttribute("label",recent);frag.lastChild.setAttribute("tooltiptext",recent);frag.lastChild.style.fontWeight="bold";frag.lastChild.setAttribute("disabled","true");frag.lastChild.style.color="black";_self.buildBM2(node,frag);var sep=_mDocument.createElementNS(_mNS,"menuseparator");sep.setAttribute("id","yahoo-bookmarks-quickaccess-separator");if(parent.qaFolder){parent.insertBefore(frag,parent.qaFolder);parent.insertBefore(sep,parent.qaFolder);parent.qaFolder=null;}else{parent.appendChild(frag);parent.appendChild(sep);}}
else{menu=_mDocument.createElementNS(_mNS,"menu");menu.setAttribute("id","yahoo-bookmarks-quickaccess-folder");menu.setAttribute("label",recent);menu.setAttribute("tooltiptext",recent);if(_self.bm2Prefs.DisplayFoldersAs=="TagView"){menu.setAttribute("class","menu-iconic");menu.setAttribute("image","chrome://ytoolbar/skin/tag.gif");}else{menu.setAttribute("class","menu-iconic folder-item");}
menupopup=_mDocument.createElementNS(_mNS,"menupopup");_self.buildBM2(node,menupopup);menu.appendChild(menupopup);parent.appendChild(menu);parent.qaFolder=menu;}
break;case"FrequentUse":var frequent;if(yahooStr!==null){frequent=yahooStr.wrappedJSObject.object["yahoo.bm.quick.frequent"];}else{frequent="Quick List";}
if((_self.bm2Prefs.ToolbarDisplay-1)==0||node.getAttribute("total")==="0"){break;}
if(_self.bm2Prefs.OrderBy==="FrequentlyAccessed"){var frag=_mDocument.createDocumentFragment();frag.appendChild(_mDocument.createElementNS(_mNS,"menuitem"));frag.lastChild.setAttribute("label",frequent);frag.lastChild.setAttribute("tooltiptext",frequent);frag.lastChild.style.fontWeight="bold";frag.lastChild.setAttribute("disabled","true");frag.lastChild.style.color="black";_self.buildBM2(node,frag);var sep=_mDocument.createElementNS(_mNS,"menuseparator");sep.setAttribute("id","yahoo-bookmarks-quickaccess-separator");if(parent.qaFolder){parent.insertBefore(frag,parent.qaFolder);parent.insertBefore(sep,parent.qaFolder);parent.qaFolder=null;}else{parent.appendChild(frag);parent.appendChild(sep);}}
else{menu=_mDocument.createElementNS(_mNS,"menu");menu.setAttribute("id","yahoo-bookmarks-quickaccess-folder");menu.setAttribute("label",frequent);menu.setAttribute("tooltiptext",frequent);if(_self.bm2Prefs.DisplayFoldersAs=="TagView"){menu.setAttribute("class","menu-iconic");menu.setAttribute("image","chrome://ytoolbar/skin/tag.gif");}else{menu.setAttribute("class","menu-iconic folder-item");}
menupopup=_mDocument.createElementNS(_mNS,"menupopup");_self.buildBM2(node,menupopup);menu.appendChild(menupopup);parent.appendChild(menu);parent.qaFolder=menu;}
break;}}
uni=null;}catch(e){yahooError(e);}
if(recursionBase&&_mFileIO.isDownloading()){_mFileIO.registerNotifier("yahoo-feed-bookmarks-updated");}};this.bumpUpBM2Usage=function(bid){if(!bid){return;}
var cnt=1;if(_self.bm2Usage[bid]){cnt=parseInt(_self.bm2Usage[bid],10);cnt=(cnt<1?0:cnt)+1;}
_self.bm2Usage[bid]=""+cnt;};this.getBM2UsageString=function(){var str="";for(key in _self.bm2Usage){if(key){str+=(str.length<1?"":",")+key+"|"
+_self.bm2Usage[key];}}
return str;};this.clearBM2Usage=function(){for(key in _self.bm2Usage){_self.bm2Usage[key]=null;}
_self.bm2Usage=[];};try{var _mConfigManager=Components.classes["@yahoo.com/configmanager;1"].getService(Components.interfaces.nsIYahooConfigManager);_self.iconsOnly=_mConfigManager.getBoolValue("options.iconsonly");}catch(e){yahooError(e);}};YahooDomBuilder.prototype={classID:Components.ID("{15e84d13-9bda-4810-ad02-437d2580c87d}"),contractID:"@yahoo.com/dombuilder;1",QueryInterface:XPCOMUtils.generateQI([Components.interfaces.nsIYahooDomBuilder])};if(XPCOMUtils.generateNSGetFactory)
var NSGetFactory=XPCOMUtils.generateNSGetFactory([YahooDomBuilder]);else
var NSGetModule=XPCOMUtils.generateNSGetModule([YahooDomBuilder]);